---
layout: doc
title: AWS Cognito OpenID Connect
description: Login using Cognito as an OpenID Connect Identity Provider
navcategory: login-methods
---

:sectnumlevels: 0

== Configure OpenID Connect with Cognito

[NOTE]
====
Congitos user's must have a public email address configured to link on email (See link:/docs/v1/tech/identity-providers#linking-strategies[Linking Strategies for more on this]). An approach that will work for all users is to link on username or create an anonymous link. Using these strategies ensure that the configured Github OIDC connection works for every user, no matter their Cognito privacy settings.
====

Once you have completed this configuration you may enable an OpenID Connect "Login with Cognito" button for one or more FusionAuth Applications. See link:https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-client-apps.html[Cognito - Configuring a user pool app client] for an additional reference.

image::identity-providers/github-openid-connect-login.png[Login with Cognito, width=1200]

=== Register a Cognito User Pool

It is likely if you're interested in connecting to Cognito that you already have a user pool set up that you'd want to connect to. We're adding the steps to create a new user pool in this guide, in the interest of completeness, and in the case you would like to set up a 

You will first need to log in to link:https://aws.amazon.com[AWS].

Once logged in, search for "Cognito" in the main search field, and select the "Cognito" service.

- Choose the region you'd like the user pool to reside in from the top right dropdown. 
- Select "Manage User Pools". This might not exist if it is your first time creating a user pool. In that case, click on "Review Defaults"
- Click "Create a user pool", and name the new pool, and then click "Review Defaults", then scroll down and click "Create Pool"

Your pool is now created. The next steps are adding a test user, and setting up the OAuth settings. 

- Click on "Users and groups" under "General" in the left side bar. Click "Create User" to create a test user. 
- Click on "App clients" under "General" in the side bar. Then click "Add an app client"
- Name the client, we've used "FusionClient", and then scroll down and click "Create app client"
- Click "Show Details" and record the "App client id" and "App client secret"
- Click on "App client settings" in the left side bar. 
- 





image::identity-providers/github-openid-connect-register-application.png[Register a new GitHub OAuth Application, width=1200]

Here we have configured our application `Authorization callback URL`. If FusionAuth is running at `login.piedpiper.com`, this value should be `https://login.piedpiper.com/oauth2/callback`.

image::identity-providers/github-openid-connect-client-id-secret.png[GitHub Client ID and Secret,width=1200]

Once the application has been created, note the `Client ID` and the `Client Secret`. These will be used respectively as the [field]#Client Id# value and the [field]#Client secret# value in your FusionAuth OpenID Connect Identity Providers configuration. Please note that you may have to click on "Generate a new client secret".

=== Configure a New FusionAuth OpenID Connect Identity Provider

To create a GitHub Identity Provider return to FusionAuth and navigate to [breadcrumb]#Settings -> Identity Providers# and click `Add provider` and select `OpenID Connect` from the dialog.

This will take you to the `Add OpenID Connect` panel, and you'll fill out the required fields.

You will need to set [field]#Client authentication method# to `HTTP Basic authentication (client_secret_basic)`.

[field]#Client Id# and [field]#Client secret# values reference the previously noted GitHub OAuth Application's `Client ID` and `Client Secret`. The [field]#Redirect URL# is read only and generated for you based upon the URL of FusionAuth, this value should match the one you configured in your GitHub application.

GitHub has not implemented a well-known configuration endpoint, so you will need to disable the [field]#Discover endpoints# field and specify the endpoints manually. The values for these fields are:

* `Authorization endpoint` - `\https://github.com/login/oauth/authorize`
* `Token endpoint` - `\https://github.com/login/oauth/access_token`
* `Userinfo endpoint` - `\https://api.github.com/user`

You will need to specify `user:email` as a [field]#Scope# for your application.

In the following screenshot you will see that we have enabled this login provider for the `Pied Piper` application and enabled [field]#Create registration#.

GitHub does not implement OpenID Connect to spec. In order to pull in some additional data for populating the user profile (GitHub shortname, Image URL, etc.) you can enable a [field]#Reconcile lambda#. This example lambda below is based on a GitHub use case. This is optional.

==== Example lambda

include::docs/v1/tech/lambdas/_openid-connect-example-lambda.adoc[]

==== Options

The final item to configure is under the [breadcrumb]#Options# tab. For Github, you will want to configure:

- [field]#Unique Id claim# of `id`
- [field]#Email claim# of `email`
- [field]#Username claim# of `login`

That's it, now the `Login with GitHub` button will show up on the login page of our `Pied Piper` application.

image::identity-providers/github-openid-connect-configuration.png[FusionAuth GitHub IdP Configuration,role=shadowed bottom-cropped top-cropped]
